name: Profile Metrics & Animations

on:
  schedule:
    - cron: "0 */6 * * *"   # every 6 hours
  workflow_dispatch:

jobs:
  metrics:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Generate GitHub Metrics (with private data)
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}

          user: abhigyan-709
          template: classic
          filename: metrics.svg

          # Base sections (include private activity)
          base: header, activity, community, repositories, metadata
          base_indepth: yes

          config_timezone: Asia/Kolkata

          # ğŸ§  Languages
          plugin_languages: yes
          plugin_languages_limit: 10
          plugin_languages_details: bytes-size, percentage

          # ğŸ† Achievements
          plugin_achievements: yes
          plugin_achievements_threshold: C
          plugin_achievements_secrets: yes

          # ğŸ“Š Habits (coding patterns)
          plugin_habits: yes
          plugin_habits_from: 200
          plugin_habits_days: 14
          plugin_habits_charts: yes

          # ğŸ—“ï¸ Isometric contribution calendar
          plugin_isocalendar: yes
          plugin_isocalendar_duration: half-year

          # â­ Stars & notable repos (including private)
          plugin_stars: yes
          plugin_notable: yes
          plugin_notable_repositories: yes
          plugin_notable_from: owned

          # ğŸ“ˆ Lines of code & traffic (needs PAT)
          plugin_lines: yes
          plugin_traffic: yes

          # ğŸ‘¥ People
          plugin_people: yes
          plugin_people_types: followers, following

          # ğŸ“¦ Repositories (include private)
          plugin_repositories: yes
          plugin_repositories_affiliations: owner, collaborator, organization_member

  snake:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - uses: actions/checkout@v4

      - name: Generate snake animation
        uses: Platane/snk@v3
        with:
          github_user_name: abhigyan-709
          outputs: |
            output/github-contribution-snake.svg
            output/github-contribution-snake-dark.svg?palette=github-dark

      - name: Push snake animation
        uses: EndBug/add-and-commit@v9
        with:
          message: "chore: update contribution snake"
          add: "output/*.svg"
